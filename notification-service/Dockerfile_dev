# Build stage: Use a full JDK with Maven for building
FROM eclipse-temurin:21-jdk-alpine AS build
WORKDIR /app

# Copy the entire monorepo context into the build stage
COPY . .

# Run the build from the root, but specify the module to build with -pl
# This builds 'notification-service' and any modules it depends on (like shared-api)
RUN ./mvnw -pl notification-service -am clean package -DskipTests

# ---

# Runtime stage: Use a lightweight JRE for running the application
FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

# Copy only the final JAR from the module's target directory
COPY --from=build /app/notification-service/target/*.jar app.jar

EXPOSE 8090

ENTRYPOINT ["java", "-jar", "/app/app.jar"]